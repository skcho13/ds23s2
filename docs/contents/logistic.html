<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sungkyun Cho">
<meta name="dcterms.date" content="2023-02-11">

<title>DG Data Analysis &amp; Vis - Model building III</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../contents/modelling3_ex.html" rel="next">
<link href="../contents/modelling2.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Model building III</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">DG Data Analysis &amp; Vis</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/notice.html" class="sidebar-item-text sidebar-link">Notice</a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Introduction</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/intro.html" class="sidebar-item-text sidebar-link">Data Analysis Intro</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/setup.html" class="sidebar-item-text sidebar-link">Setup</a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../contents/pandas.html" class="sidebar-item-text sidebar-link">NumPy and pandas</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/inspection.html" class="sidebar-item-text sidebar-link">Inspecting data</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/vis.html" class="sidebar-item-text sidebar-link">Data visualization</a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Visualize</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/seaborn.html" class="sidebar-item-text sidebar-link">Seaborn.objects</a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../contents/plots.html" class="sidebar-item-text sidebar-link">Plots</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/alt_plots.html" class="sidebar-item-text sidebar-link">Alternative plots</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/customizing.html" class="sidebar-item-text sidebar-link">Customizing</a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Transform</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../contents/subsetting.html" class="sidebar-item-text sidebar-link">Subsetting</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/views.html" class="sidebar-item-text sidebar-link">Views and Copies</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../contents/transform.html" class="sidebar-item-text sidebar-link">Transforming I</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/case1.html" class="sidebar-item-text sidebar-link">Case study</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/exercise_transform.html" class="sidebar-item-text sidebar-link">Exercises</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">Transforming II</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/combine.html" class="sidebar-item-text sidebar-link">Combine</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/pivot.html" class="sidebar-item-text sidebar-link">Pivot</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/crosstab.html" class="sidebar-item-text sidebar-link">Pivot Table</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/exercise_wrangle.html" class="sidebar-item-text sidebar-link">Exercises</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">Solutions</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/sol1.html" class="sidebar-item-text sidebar-link">Transform 1 Sol</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/sol2.html" class="sidebar-item-text sidebar-link">Transform 2 Sol</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">Exercises</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../contents/exercise1.html" class="sidebar-item-text sidebar-link">Billboard</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/exercise1_sol.html" class="sidebar-item-text sidebar-link">Solutions</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../contents/exercise2.html" class="sidebar-item-text sidebar-link">MovieLens</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/exercise2_sol.html" class="sidebar-item-text sidebar-link">Solutions</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../contents/eda.html" class="sidebar-item-text sidebar-link">Exploratory Data Analysis</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/discretize.html" class="sidebar-item-text sidebar-link">Discretize</a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true">Modelling</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/modelbasic.html" class="sidebar-item-text sidebar-link">Model basics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/modelling1.html" class="sidebar-item-text sidebar-link">Model building I</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/modelling2.html" class="sidebar-item-text sidebar-link">Model building II</a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../contents/logistic.html" class="sidebar-item-text sidebar-link active">Model building III</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/modelling3_ex.html" class="sidebar-item-text sidebar-link">Exercises</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents/misc2.html" class="sidebar-item-text sidebar-link">Misc.</a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">Statistics</span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" aria-expanded="true">Communicate</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://docs.google.com/document/d/1cZ0JzhjjdMBYtlpgkKGJ9LSbuwcv5eRIOQ5CRahw5Js/edit?usp=sharing" class="sidebar-item-text sidebar-link">Ask</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://docs.google.com/document/d/1CFVAUGKB1h8z3vEAl5vjp5lvYiv-FLYtlRDFGSN2_aY/edit?usp=sharing" class="sidebar-item-text sidebar-link">Personal Project</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#ordinary-least-squares-ols" id="toc-ordinary-least-squares-ols" class="nav-link active" data-scroll-target="#ordinary-least-squares-ols">Ordinary least squares (OLS)</a></li>
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression">Logistic Regression</a>
  <ul>
  <li><a href="#emperical-probability-odds" id="toc-emperical-probability-odds" class="nav-link" data-scroll-target="#emperical-probability-odds">Emperical probability/ Odds</a></li>
  <li><a href="#예측값" id="toc-예측값" class="nav-link" data-scroll-target="#예측값">예측값</a></li>
  <li><a href="#모형의-파라미터-해석" id="toc-모형의-파라미터-해석" class="nav-link" data-scroll-target="#모형의-파라미터-해석">모형의 파라미터 해석</a></li>
  <li><a href="#모형의-예측력" id="toc-모형의-예측력" class="nav-link" data-scroll-target="#모형의-예측력">모형의 예측력</a>
  <ul class="collapse">
  <li><a href="#evaluattion-of-predicted-probability" id="toc-evaluattion-of-predicted-probability" class="nav-link" data-scroll-target="#evaluattion-of-predicted-probability">Evaluattion of predicted probability</a></li>
  <li><a href="#evaluation-of-predicted-class" id="toc-evaluation-of-predicted-class" class="nav-link" data-scroll-target="#evaluation-of-predicted-class">Evaluation of predicted class</a></li>
  </ul></li>
  <li><a href="#logistic-regression-정리" id="toc-logistic-regression-정리" class="nav-link" data-scroll-target="#logistic-regression-정리">Logistic Regression 정리</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul>
  <li><a href="#a.-blowdown" id="toc-a.-blowdown" class="nav-link" data-scroll-target="#a.-blowdown">A. Blowdown</a></li>
  <li><a href="#b.-the-u.s.-youth-risk-behavior-surveillance-system" id="toc-b.-the-u.s.-youth-risk-behavior-surveillance-system" class="nav-link" data-scroll-target="#b.-the-u.s.-youth-risk-behavior-surveillance-system">B. The U.S. Youth Risk Behavior Surveillance System</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Model building III</h1>
<p class="subtitle lead">R for Data Science by Wickham &amp; Grolemund</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sungkyun Cho </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 11, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell" data-execution_count="95">
<details>
<summary>Load Packages</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># numerical calculation &amp; data frames</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># visualization</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn.objects <span class="im">as</span> so</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sbcustom <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># statistics</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="97">
<details>
<summary>Options</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pandas options</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">"mode.copy_on_write"</span>, <span class="va">True</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>pd.options.display.precision <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">'</span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span>  <span class="co"># pd.reset_option('display.float_format')</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_rows <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Numpy options</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>np.set_printoptions(precision <span class="op">=</span> <span class="dv">2</span>, suppress<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="ordinary-least-squares-ols" class="level1">
<h1>Ordinary least squares (OLS)</h1>
<ul>
<li><p>Mean function: <span class="math inline">\(E(Y | X = x_i) = \beta_0 + \beta_1 x_i\)</span></p></li>
<li><p>Variance function: <span class="math inline">\(Var(Y | X = x_i) = \sigma^2\)</span></p></li>
<li><p>Distribution: <span class="math inline">\((Y | X = x_i) \sim N(\beta_0 + \beta_1 x_i, \sigma^2)\)</span></p></li>
</ul>
<p><img src="images/ols.png" class="img-fluid" width="650"><br>
Source: p.107, <em>Applied Regression Analysis and Generalized Linear Models (3e), by John Fox</em></p>
<p><img src="images/glm.png" class="img-fluid" width="800"><br>
Source: p.482, <em>Applied Multiple Regression/Correlation Analysis for the Behavioral Sciences (3e), by Cohen, J., Cohen, P., West, S. G., &amp; Aiken, L. S.</em></p>
</section>
<section id="logistic-regression" class="level1">
<h1>Logistic Regression</h1>
<p>Response 변수가 binary인 경우,</p>
<p>예제: Blowdown<br>
<em>p.274, Applied Linear Regression (4e) by Sanford Weisberg</em></p>
<p>Data: <a href="https://www.dropbox.com/s/vi8vxaxlejds0d2/blowdown.csv?dl=1">blowdown.csv</a></p>
<blockquote class="blockquote">
<p>On July 4, 1999, a storm with winds exceeding 90 miles per hour hit the Boundary Waters Canoe Area Wilderness in northeastern Minnesota, causing serious damage to the forest. Rich et al.&nbsp;(2007) studied the effects of this storm using a very extensive ground survey of the area, determining status, either alive or dead, of more than 3600 trees.</p>
</blockquote>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>blowdown <span class="op">=</span> pd.read_csv(<span class="st">'data/blowdown.csv'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>blowdown</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="98">
<pre><code>         d    s  y         spp
0     9.00 0.02  0  balsam fir
1    14.00 0.02  0  balsam fir
2    18.00 0.02  0  balsam fir
3    23.00 0.02  0  balsam fir
...    ...  ... ..         ...
3662 20.00 0.98  1    jackpine
3663 19.00 0.98  1    jackpine
3664 37.00 0.98  1   black ash
3665 48.00 0.98  1   black ash

[3666 rows x 4 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># black spruce에 제한하고, diameter d를 log2로 변환</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>blowbs <span class="op">=</span> blowdown.query(<span class="st">'spp == "black spruce"'</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>blowbs[<span class="st">"d"</span>] <span class="op">=</span> np.floor(blowbs[<span class="st">"d"</span>])</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>blowbs[<span class="st">"log2d"</span>] <span class="op">=</span> np.log2(blowbs[<span class="st">"d"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>blowbs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="100">
<pre><code>         d    s  y           spp  log2d
17    9.00 0.02  0  black spruce   3.17
24   11.00 0.03  0  black spruce   3.46
25    9.00 0.03  0  black spruce   3.17
50    9.00 0.03  0  black spruce   3.17
...    ...  ... ..           ...    ...
3636  5.00 0.94  0  black spruce   2.32
3646  9.00 0.94  1  black spruce   3.17
3647 17.00 0.94  1  black spruce   4.09
3661  8.00 0.98  1  black spruce   3.00

[659 rows x 5 columns]</code></pre>
</div>
</div>
<p>기존의 ordinary least squares (OLS) 방법으로 fit을 하면, (linear probability model)</p>
<ul>
<li>Y를 0, 1로 coding하면; 1: event, 0: non-event</li>
<li>Mean funtion <span class="math inline">\(E(Y | X = x_i)\)</span>을 생각하면 각 나무의 두께에 해당하는 쓰러진 나무의 비율, 즉 확률값으로 해석할 수 있음.</li>
</ul>
<div class="cell" data-execution_count="101">
<details>
<summary>code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    so.Plot(blowbs, x<span class="op">=</span><span class="st">'d'</span>, y<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    .add(so.Dots(alpha<span class="op">=</span><span class="fl">.3</span>), so.Jitter(y<span class="op">=</span><span class="fl">.1</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    .add(so.Line(), so.PolyFit(<span class="dv">5</span>))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    .add(so.Line(), so.PolyFit(<span class="dv">1</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    .limit(y<span class="op">=</span>(<span class="op">-</span><span class="fl">0.2</span>, <span class="fl">1.2</span>))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    .layout(size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="101">
<p><img src="logistic_files/figure-html/cell-8-output-1.png" width="753" height="465"></p>
</div>
</div>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.formula.api <span class="im">import</span> ols</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>mod_ols <span class="op">=</span> ols(<span class="st">'y ~ d'</span>, data <span class="op">=</span> blowbs).fit()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>mod_ols.params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>Intercept   -0.16
d            0.05
dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="103">
<details>
<summary>code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>blowbs_plot <span class="op">=</span> blowbs.assign(resid <span class="op">=</span> mod_ols.resid)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    so.Plot(blowbs_plot, x<span class="op">=</span><span class="st">'d'</span>, y<span class="op">=</span><span class="st">'resid'</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    .add(so.Dots(), so.Jitter(y<span class="op">=</span><span class="fl">.1</span>))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    .label(title<span class="op">=</span><span class="st">'Residual Plot'</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="103">
<p><img src="logistic_files/figure-html/cell-10-output-1.png" width="599" height="445"></p>
</div>
</div>
<p>Distributions for d</p>
<div class="cell" data-execution_count="104">
<details>
<summary>code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    so.Plot(blowbs_plot.query(<span class="st">'d &lt; 15'</span>), x<span class="op">=</span><span class="st">'resid'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    .add(so.Bar(), so.Hist(stat<span class="op">=</span><span class="st">"proportion"</span>))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    .facet(<span class="st">"d"</span>, wrap<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    .layout(size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    .label(title<span class="op">=</span><span class="st">'d = </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="104">
<p><img src="logistic_files/figure-html/cell-11-output-1.png" width="753" height="369"></p>
</div>
</div>
<section id="emperical-probability-odds" class="level2">
<h2 class="anchored" data-anchor-id="emperical-probability-odds">Emperical probability/ Odds</h2>
<p>이제 y를 직접 예측하기보다, 확률을 예측하는 방식을 취하면,</p>
<ul>
<li>각 두께를 가진 나무들의 개수 (<code>m</code>)와</li>
<li>그 중에 태풍으로 죽은 나무의 수 (<code>died</code>)를 고려하면,</li>
<li>나무의 두께에 따라 죽은 나무 수의 비율 (<code>p</code>= <code>died</code>/<code>m</code>)을 계산할 수 있음. 이를 emperical probability라고 함.</li>
<li>사실, 이 <code>p</code>는 binary response (0, 1)의 conditional mean(평균)인데,</li>
<li>통계적으로 표현하면 <span class="math inline">\(E(Y|d=d_i)\)</span>이며 선형모형의 mean function를 제공. (모형은 variance function과 함께 설정됨)</li>
</ul>
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>blowbs_bn <span class="op">=</span> blowbs.groupby(<span class="st">"d"</span>)[<span class="st">"y"</span>].agg([(<span class="st">"died"</span>, <span class="st">"sum"</span>), (<span class="st">"m"</span>, <span class="st">"count"</span>), (<span class="st">"p"</span>, <span class="st">"mean"</span>)]).reset_index()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># blowbs_bn = blowbs_bn.assign(</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     p = (blowbs_bn.died + 0.1)/ (blowbs_bn.m + 0.2),  # 확률이 0이거나 1이 되는 것을 피하기 위해 작은 값을 추가</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>blowbs_bn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<pre><code>       d  died   m    p
0   5.00     7  90 0.08
1   6.00     7  92 0.08
2   7.00    18  91 0.20
3   8.00    13  70 0.19
..   ...   ...  ..  ...
21 27.00     1   1 1.00
22 28.00     2   2 1.00
23 29.00     1   2 0.50
24 32.00     1   1 1.00

[25 rows x 4 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="106">
<details>
<summary>code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    so.Plot(blowbs_bn, x<span class="op">=</span><span class="st">'d'</span>, y<span class="op">=</span><span class="st">'p'</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    .add(so.Dots(color<span class="op">=</span><span class="st">"orangered"</span>), pointsize<span class="op">=</span><span class="st">'m'</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    .add(so.Dots(alpha<span class="op">=</span><span class="fl">.3</span>), so.Jitter(y<span class="op">=</span><span class="fl">.1</span>), x<span class="op">=</span>blowbs.d, y<span class="op">=</span>blowbs.y)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    .add(so.Line(), so.PolyFit(<span class="dv">5</span>))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    .add(so.Line(), so.PolyFit(<span class="dv">1</span>))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    .limit(y<span class="op">=</span>(<span class="op">-</span><span class="fl">0.2</span>, <span class="fl">1.2</span>))</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    .layout(size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    .label(title<span class="op">=</span><span class="st">'Emperical Probability'</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="106">
<p><img src="logistic_files/figure-html/cell-13-output-1.png" width="831" height="465"></p>
</div>
</div>
<ul>
<li>OLS estimate으로도 충분한가?</li>
<li>1차보다는 고차 다항함수로 fit한다면?</li>
</ul>
<p>우선 d를 log2 변환해서 살펴보면,</p>
<div class="cell" data-execution_count="107">
<details>
<summary>code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>blowbs_bn[<span class="st">"log2d"</span>] <span class="op">=</span> np.log2(blowbs_bn[<span class="st">"d"</span>])</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    so.Plot(blowbs_bn, x<span class="op">=</span><span class="st">'log2d'</span>, y<span class="op">=</span><span class="st">'p'</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    .add(so.Dots(color<span class="op">=</span><span class="st">"orangered"</span>), pointsize<span class="op">=</span><span class="st">'m'</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    .add(so.Dots(alpha<span class="op">=</span><span class="fl">.3</span>), so.Jitter(y<span class="op">=</span><span class="fl">.1</span>), x<span class="op">=</span>blowbs.log2d, y<span class="op">=</span>blowbs.y)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    .add(so.Line(), so.PolyFit(<span class="dv">5</span>))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    .add(so.Line(), so.PolyFit(<span class="dv">1</span>))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    .limit(y<span class="op">=</span>(<span class="op">-</span><span class="fl">0.2</span>, <span class="fl">1.2</span>))</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    .layout(size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    .label(title<span class="op">=</span><span class="st">'Emperical Probability'</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="107">
<p><img src="logistic_files/figure-html/cell-14-output-1.png" width="831" height="465"></p>
</div>
</div>
<p>만약, 이 proportion p (= died/m)를 log2d로 예측하는 모형을 만들어, 그 잔차를 살펴보면,</p>
<div class="cell" data-execution_count="108">
<details>
<summary>code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>mod_prob <span class="op">=</span> ols(<span class="st">'p ~ log2d'</span>, data <span class="op">=</span> blowbs_bn).fit()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>mod_prob_plot <span class="op">=</span> blowbs_bn.assign(resid <span class="op">=</span> mod_prob.resid)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    so.Plot(mod_prob_plot, x<span class="op">=</span><span class="st">'log2d'</span>, y<span class="op">=</span><span class="st">'resid'</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    .add(so.Dot())</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    .add(so.Line(color<span class="op">=</span><span class="st">".3"</span>, linestyle<span class="op">=</span><span class="st">":"</span>), so.Agg(<span class="kw">lambda</span> x: <span class="dv">0</span>))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    .label(title<span class="op">=</span><span class="st">'Residual Plot'</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="108">
<p><img src="logistic_files/figure-html/cell-15-output-1.png" width="599" height="445"></p>
</div>
</div>
<p>위에서 살펴본 OLS의 문제들 즉,</p>
<ul>
<li>잔차에 패턴이 보인다는 것은 충분히 좋은 모형이 아니라는 것을 의미하고,</li>
<li>예측값이 확률을 의미하지 못할 수 있음.</li>
<li>잔차의 분산이 x값에 따라 달라져 모집단에 대한 추론을 어렵게 함.</li>
</ul>
<p>이런 문제들을 해결하고 예측값이 분명한 “확률”의 의미를 품도록 여러 방식이 제시되는데 주로 사용되는 것이 logistic regression임.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p><em>Binary outcome을 예측하는 모형은 binary 값을 예측하는 것이 아니고, 확률 값을 예측하는 것임.</em><br>
이후에 이를 이용해 binary outcome을 예측.</p>
<ul>
<li>예를 들어, 두께가 5cm인 (특정 종의) 나무가 (특정 강도의) 태풍에 쓰러질 확률(true probability)을 파악하고자 함.</li>
<li>이 때, 관측값은 5cm인 나무 중 쓰러진 나무의 비율이고, 이를 관측치들로 true probability를 추정하고자 함.</li>
</ul>
<p><strong>Odds</strong>의 정의: 실패할 확률 대비 성공할 확률의 비율</p>
<p><span class="math inline">\(\displaystyle odds = \frac{p}{1-p}\)</span></p>
<p>예를 들어, 5cm 두께의 나무는 90그루 중 7그루가 죽었으므로 83그루는 살았음.<br>
즉, 죽음:생존 = 7:83 <span class="math inline">\(\approx\)</span> 1:12 이고 odds = 7/83 = 0.084; 생존할 가능성 대비 죽을 가능성이 8.4%임.<br>
확률로 표현하면, <span class="math inline">\(odds = \frac{\frac{7}{90}}{1 - \frac{7}{90}} = \frac{7}{90-7} = \frac{7}{83}\)</span></p>
<p>확률과 odds, logit(log odds)의 관계</p>
<p><img src="images/odds.png" class="img-fluid" width="400"></p>
</div>
</div>
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>blowbs_bn <span class="op">=</span> blowbs_bn.assign(odds <span class="op">=</span> <span class="kw">lambda</span> x: x.p <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> x.p))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># p = 1인 경우 odds가 무한대가 되므로 편의상 inf 값을 50으로 대체</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>blowbs_bn[<span class="st">"odds"</span>] <span class="op">=</span> blowbs_bn[<span class="st">"odds"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="dv">50</span> <span class="cf">if</span> x <span class="op">==</span> np.inf <span class="cf">else</span> x)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>blowbs_bn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="109">
<pre><code>       d  died   m    p  log2d  odds
0   5.00     7  90 0.08   2.32  0.08
1   6.00     7  92 0.08   2.58  0.08
2   7.00    18  91 0.20   2.81  0.25
3   8.00    13  70 0.19   3.00  0.23
..   ...   ...  ..  ...    ...   ...
21 27.00     1   1 1.00   4.75 50.00
22 28.00     2   2 1.00   4.81 50.00
23 29.00     1   2 0.50   4.86  1.00
24 32.00     1   1 1.00   5.00 50.00

[25 rows x 6 columns]</code></pre>
</div>
</div>
<p>이 odds를 선형모형으로 나무두께로 예측하려고 하는 것인데, 예를 들어,</p>
<p><span class="math inline">\(\widehat{odds} = b_0 + b_1 \cdot log_{2}(d)\)</span></p>
<p>odds 값의 범위는 (0, <span class="math inline">\(\infty\)</span>)이므로, 선형모형으로 fit하는 것이 적절하지 않음.<br>
한편, odds를 log 변환하면, 그 범위는 (<span class="math inline">\(-\infty\)</span>, <span class="math inline">\(\infty\)</span>)가 되어 선형모형으로 fit하는 것이 적절해짐.</p>
<p><span class="math inline">\(\displaystyle logit(p):= log(odds) = log\left(\frac{p}{1-p}\right)\)</span><br>
이 때, 예측모형은 <span class="math inline">\(\displaystyle log\left(\frac{\hat{p}}{1-\hat{p}}\right) = b_0 + b_1 \cdot log_{2}(d)\)</span></p>
<p>즉, logit은 예측변수 <span class="math inline">\(x\)</span> 와 선형적으로 연결되는데 반해, 확률 <span class="math inline">\(p\)</span> 는 예측변수 <span class="math inline">\(x\)</span> 와 비선형적 관계를 맺음</p>
<div class="cell" data-execution_count="110">
<div class="cell-output cell-output-display" data-execution_count="110">
<p><img src="logistic_files/figure-html/cell-17-output-1.png" width="465" height="369"></p>
</div>
</div>
<p>log odds값을 구해보면,</p>
<div class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>blowbs_bn <span class="op">=</span> blowbs_bn.assign(log_odds <span class="op">=</span> <span class="kw">lambda</span> x: np.log(x.odds))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>blowbs_bn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="111">
<pre><code>       d  died   m    p  log2d  odds  log_odds
0   5.00     7  90 0.08   2.32  0.08     -2.47
1   6.00     7  92 0.08   2.58  0.08     -2.50
2   7.00    18  91 0.20   2.81  0.25     -1.40
3   8.00    13  70 0.19   3.00  0.23     -1.48
..   ...   ...  ..  ...    ...   ...       ...
21 27.00     1   1 1.00   4.75 50.00      3.91
22 28.00     2   2 1.00   4.81 50.00      3.91
23 29.00     1   2 0.50   4.86  1.00      0.00
24 32.00     1   1 1.00   5.00 50.00      3.91

[25 rows x 7 columns]</code></pre>
</div>
</div>
<p>정리하면, 아래와 같은 관측값들과 <strong>emperical probability/log odds</strong>을 함께 살펴보면,</p>
<div class="cell" data-execution_count="112">
<details>
<summary>code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>blowbs_bn.log2d, y<span class="op">=</span>blowbs_bn.p, size<span class="op">=</span>blowbs_bn.m, sizes<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">200</span>), ax<span class="op">=</span>ax)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> jitter(values, j):</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> values <span class="op">+</span> np.random.normal(<span class="dv">0</span>, j, values.shape)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>blowbs.log2d, y<span class="op">=</span>jitter(blowbs.y, <span class="fl">0.02</span>), alpha<span class="op">=</span><span class="fl">.3</span>, ax<span class="op">=</span>ax)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, row <span class="kw">in</span> blowbs_bn.iterrows():</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    ax.annotate(<span class="ss">f"</span><span class="sc">{</span>row<span class="sc">.</span>died<span class="sc">:n}</span><span class="ss">/</span><span class="sc">{</span>row<span class="sc">.</span>m<span class="sc">:n}</span><span class="ss">"</span>, xy<span class="op">=</span>(row.log2d, row.p), xytext<span class="op">=</span>(row.log2d, row.p<span class="op">-</span><span class="fl">0.05</span>), size<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(blowbs_bn.log2d.unique())</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(blowbs_bn.log2d.unique().<span class="bu">round</span>(<span class="dv">2</span>))</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Emperical Probability"</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>ax.legend_.remove()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="logistic_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Logit 값을 추가해서 그리면,</p>
<div class="cell" data-execution_count="113">
<details>
<summary>code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>blowbs_bn.log2d, y<span class="op">=</span>blowbs_bn.p, size<span class="op">=</span>blowbs_bn.m, sizes<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">200</span>), ax<span class="op">=</span>ax, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>blowbs_bn.log2d, y<span class="op">=</span>blowbs_bn.log_odds, size<span class="op">=</span>blowbs_bn.m, sizes<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">200</span>), color<span class="op">=</span><span class="st">"red"</span>, ax<span class="op">=</span>ax)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> jitter(values, j):</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> values <span class="op">+</span> np.random.normal(<span class="dv">0</span>, j, values.shape)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>blowbs.log2d, y<span class="op">=</span>jitter(blowbs.y, <span class="fl">0.02</span>), alpha<span class="op">=</span><span class="fl">.3</span>, ax<span class="op">=</span>ax)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, row <span class="kw">in</span> blowbs_bn.iterrows():</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    ax.annotate(<span class="ss">f"logit</span><span class="sc">{</span>row<span class="sc">.</span>died<span class="sc">:n}</span><span class="ss">/</span><span class="sc">{</span>row<span class="sc">.</span>m<span class="sc">:n}</span><span class="ss">"</span>, xy<span class="op">=</span>(row.log2d, row.log_odds), xytext<span class="op">=</span>(row.log2d, row.log_odds<span class="op">-</span><span class="fl">0.4</span>), size<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(blowbs_bn.log2d.unique())</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(blowbs_bn.log2d.unique().<span class="bu">round</span>(<span class="dv">2</span>))</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"P &amp; Logit"</span>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Emperical Probability and Logit"</span>)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>ax.legend_.remove()</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co"># # polyfit 5</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co"># x = np.linspace(blowbs_bn.log2d.min(), blowbs_bn.log2d.max(), 100)</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co"># y = np.polyval(np.polyfit(blowbs_bn.log2d, blowbs_bn.log_odds, 5), x)</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.lineplot(x=x, y=y, ax=ax, color=".6")</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="co"># # polyfit 1</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co"># y = np.polyval(np.polyfit(blowbs_bn.log2d, blowbs_bn.log_odds, 1), x)</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.lineplot(x=x, y=y, ax=ax, color=".6")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="logistic_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>위의 logit값을 선형모형으로 예측하는 모형: <span class="math inline">\(\displaystyle log\left(\frac{\hat{p}}{1-\hat{p}}\right) = b_0 + b_1 \cdot log_{2}(d)\)</span></p>
<p>파라미터 <span class="math inline">\(b_0, b_1\)</span>의 추정은 잔차들의 제곱의 합을 최소로 하는 OLS 방식은 부적절하며, 대신에 Maximum Likelihood Estimation을 사용함.</p>
<ul>
<li>아이디어는 관측치가 전체적으로 관찰될 likelihood가 최대가 되도록 <span class="math inline">\(b_0, b_1\)</span>을 선택하는 것임</li>
<li>이를 위해서 확률모형을 결합시켜야 함.</li>
<li>기본적으로 선택하는 확률모형은 binominal distribution (이항분포)임.</li>
<li>이항분포의 평균과 표준편차는 확률 p와 n에 의해 바뀜.</li>
<li>관찰값은 이항분포로부터 발생했다고 가정함으로써, 실제 관찰값들의 randomness(잔차들)을 모형에 반영할 수 있음.</li>
</ul>
<p>참고: 이항분포 (Y: 사건의 횟수)<br>
<img src="images/binomial.png" class="img-fluid" width="750"></p>
<div class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>blowbs_bn.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="114">
<pre><code>     d  died   m    p  log2d  odds  log_odds
0 5.00     7  90 0.08   2.32  0.08     -2.47
1 6.00     7  92 0.08   2.58  0.08     -2.50
2 7.00    18  91 0.20   2.81  0.25     -1.40</code></pre>
</div>
</div>
<p><img src="images/blowdown.png" class="img-fluid" width="800"></p>
<p>각 likelihood는 관측치들이 모두 <strong>독립</strong>적으로 발생했다고 가정했을 때의 확률값이고,<br>
모든 데이터가 관찰될 likelihood:<br>
Lik = <span class="math inline">\(_{90}C_7 \cdot p_1^7 \cdot (1-p_1)^{83} \cdot _{92}C_7 \cdot p_2^7 \cdot (1-p_2)^{85} \cdot _{91}C_{18} \cdot p_3^{18} \cdot (1-p_3)^{73} \cdots\)</span></p>
<p>이 때, 모형을 예측변수 x의 1차 다항함수로 fit한다면, &nbsp; <span class="math inline">\(\displaystyle log\left(\frac{p}{1-p}\right) = \beta_0 + \beta_1 \cdot x\)</span> 인데,<br>
변형하면 &nbsp; <span class="math inline">\(\displaystyle p = \frac{1}{1+e^{-(\beta_0 + \beta_1 \cdot x)}}\)</span></p>
<p>Lik <span class="math inline">\(\propto\)</span> <span class="math inline">\(\displaystyle \left(\frac{1}{1+e^{-(\beta_0 + \beta_1 \cdot 2.32)}}\right)^7 \cdot \left(1 - \frac{1}{1+e^{-(\beta_0 + \beta_1 \cdot 2.32)}}\right)^{83} \cdot \left(\frac{1}{1+e^{-(\beta_0 + \beta_1 \cdot 2.58)}}\right)^7 \cdot \left(\frac{1}{1+e^{-(\beta_0 + \beta_1 \cdot 2.58)}}\right)^{85} \cdots\)</span></p>
<p>이 Likelihood를 최대가 되도록 <span class="math inline">\(\beta_0, \beta_1\)</span>의 추정치를 찾는 것이 Maximum Likelihood Estimation임.</p>
<div class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.formula.api <span class="im">import</span> glm, logit</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Binomial response</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>mod_bn <span class="op">=</span> glm(<span class="st">'died + I(m-died) ~ log2d'</span>, data<span class="op">=</span>blowbs_bn, family<span class="op">=</span>sm.families.Binomial()).fit()</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Binary response: 동일한 분석</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>mod <span class="op">=</span> logit(<span class="st">'y ~ log2d'</span>, data<span class="op">=</span>blowbs).fit() <span class="co"># 아래와 동일하나 다른 methods를 제공</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>mod <span class="op">=</span> glm(<span class="st">'y ~ log2d'</span>, data<span class="op">=</span>blowbs, family<span class="op">=</span>sm.families.Binomial()).fit()</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mod.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.499165
         Iterations 6
                 Generalized Linear Model Regression Results                  
==============================================================================
Dep. Variable:                      y   No. Observations:                  659
Model:                            GLM   Df Residuals:                      657
Model Family:                Binomial   Df Model:                            1
Link Function:                  Logit   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:                -328.95
Date:                Mon, 05 Jun 2023   Deviance:                       657.90
Time:                        10:32:39   Pearson chi2:                     679.
No. Iterations:                     5   Pseudo R-squ. (CS):             0.2599
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     -7.8162      0.628    -12.437      0.000      -9.048      -6.584
log2d          2.2408      0.190     11.773      0.000       1.868       2.614
==============================================================================</code></pre>
</div>
</div>
<p>Model deviance:<br>
<span class="math inline">\(D_k = -2[log(likelihood_k) - log(likelihood_{perfect})]\)</span></p>
<ul>
<li>Perfect model의 likelihood: 1</li>
</ul>
<div class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># deviance for an intercept only model</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>mod.null_deviance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="116">
<pre><code>856.2073760911842</code></pre>
</div>
</div>
<ul>
<li>Pseudo R-squared: <span class="math inline">\(\displaystyle \frac{Null~Deviance - Deviance}{Null~Deviance}\)</span></li>
<li>Cox-Snell’s Pseudo R-squared</li>
<li>Nagelkerke’s Pseudo R-squared</li>
</ul>
<p>위 fitted model의 예측값들: fitted line</p>
<div class="cell" data-execution_count="117">
<details>
<summary>code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">5</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>blowbs_bn.log2d, y<span class="op">=</span>blowbs_bn.p, size<span class="op">=</span>blowbs_bn.m, sizes<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">200</span>), ax<span class="op">=</span>ax, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> jitter(values, j):</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> values <span class="op">+</span> np.random.normal(<span class="dv">0</span>, j, values.shape)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>blowbs.log2d, y<span class="op">=</span>jitter(blowbs.y, <span class="fl">0.02</span>), alpha<span class="op">=</span><span class="fl">.3</span>, ax<span class="op">=</span>ax)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, row <span class="kw">in</span> blowbs_bn.iterrows():</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    ax.annotate(<span class="ss">f"</span><span class="sc">{</span>row<span class="sc">.</span>died<span class="sc">:n}</span><span class="ss">/</span><span class="sc">{</span>row<span class="sc">.</span>m<span class="sc">:n}</span><span class="ss">"</span>, xy<span class="op">=</span>(row.log2d, row.p), xytext<span class="op">=</span>(row.log2d, row.p<span class="op">-</span><span class="fl">0.05</span>), size<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(blowbs_bn.log2d.unique())</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(blowbs_bn.log2d.unique().<span class="bu">round</span>(<span class="dv">2</span>))</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co"># x-axis with 45 degree rotation</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co"># fitted line</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span>blowbs.log2d, y<span class="op">=</span>mod.fittedvalues, ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">".6"</span>)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="logistic_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="예측값" class="level2">
<h2 class="anchored" data-anchor-id="예측값">예측값</h2>
<p>Logistic regression에서는 세 가지 타입의 예측값들이 있음.</p>
<ul>
<li>Predicted probability: &nbsp; <span class="math inline">\(\displaystyle \hat{p} = \frac{1}{1+e^{-(b_0 + b_1 \cdot x)}}\)</span></li>
<li>Odds: &nbsp; <span class="math inline">\(\displaystyle odds = \frac{\hat{p}}{1 - \hat{p}} = e^{b_0 + b_1 \cdot x}\)</span></li>
<li>Log odds: &nbsp; <span class="math inline">\(\displaystyle logit = b_0 + b_1 \cdot x\)</span></li>
</ul>
<div class="cell" data-execution_count="118">
<details>
<summary>code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>blowbs_bn_pred <span class="op">=</span> blowbs_bn.assign(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    pred_prob <span class="op">=</span> mod_bn.fittedvalues,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    pred_odds <span class="op">=</span> <span class="kw">lambda</span> x: x.pred_prob <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> x.pred_prob),</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    pred_logit <span class="op">=</span> <span class="kw">lambda</span> x: np.log(x.pred_odds)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>blowbs_bn_pred.iloc[:, <span class="dv">1</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="118">
<pre><code>    died   m    p  log2d  odds  log_odds  pred_prob  pred_odds  pred_logit
0      7  90 0.08   2.32  0.08     -2.47       0.07       0.07       -2.61
1      7  92 0.08   2.58  0.08     -2.50       0.12       0.13       -2.02
2     18  91 0.20   2.81  0.25     -1.40       0.18       0.22       -1.53
3     13  70 0.19   3.00  0.23     -1.48       0.25       0.33       -1.09
..   ...  ..  ...    ...   ...       ...        ...        ...         ...
21     1   1 1.00   4.75 50.00      3.91       0.94      17.09        2.84
22     2   2 1.00   4.81 50.00      3.91       0.95      19.22        2.96
23     1   2 0.50   4.86  1.00      0.00       0.96      21.53        3.07
24     1   1 1.00   5.00 50.00      3.91       0.97      29.59        3.39

[25 rows x 9 columns]</code></pre>
</div>
</div>
<p>예를 들어, 두께(<code>log2d</code>)가 3인 나무의 경우,</p>
<ul>
<li>Probabiliy: 태풍에 쓰러질 확률은 25%로 예측되며,</li>
<li>Odds: 태풍에 쓰러지지 않을 가능성 대비 쓰러질 가능성의 비율은 1:0.33이므로 대략 3:1로 예측됨. 즉 다시 말하면, 1 그루가 쓰러진다면 3 그루는 쓰러지지 않을 것으로 예측함.
<ul>
<li>Odds가 1이면 event의 확률(p)이 0.5</li>
<li>Odds가 1보다 작으면 event의 확률(p)이 0.5보다 작고,</li>
<li>Odds가 1보다 크면 event의 확률(p)이 0.5보다 큼.</li>
</ul></li>
<li>Log odds (logit): 확률 p의 [0, 1]의 값을 무한한 값으로 늘려 linearly fit할 수 있게 함.</li>
</ul>
</section>
<section id="모형의-파라미터-해석" class="level2">
<h2 class="anchored" data-anchor-id="모형의-파라미터-해석">모형의 파라미터 해석</h2>
<p><strong>Odds의 비율 (odds ratio, OR)</strong>을 통해 해석</p>
<ul>
<li><p><span class="math inline">\(\displaystyle odds: \frac{\hat{p}}{1 - \hat{p}} = e^{b_0 + b_1 \cdot x}=e^{b_0}\cdot e^{b_1 \cdot x}\)</span> &nbsp;로부터</p></li>
<li><p><span class="math inline">\(x\)</span>가 1 증가할 때 odds의 비율: <span class="math inline">\(\displaystyle odds ~ratio: \frac{\frac{\hat{p_2}}{1 - \hat{p_2}}}{\frac{\hat{p_1}}{1 - \hat{p_1}}} = e^{b_1 \cdot (x+1) - b_1 \cdot x} = e^{b_1}\)</span></p></li>
<li><p>즉, <span class="math inline">\(x\)</span>가 1 증가하면, odds가 “몇 배”로 증가하는지를 나타냄.</p></li>
<li><p>따라서, odds ratio가 1보다 크면 (<span class="math inline">\(b_1\)</span>이 양수) <span class="math inline">\(x\)</span>가 1 증가할 때, event의 odds가 커지며,</p></li>
<li><p>odds ratio가 1보다 작으면 (<span class="math inline">\(b_1\)</span>이 음수) event의 odds가 줄어듬.</p></li>
</ul>
<p>위의 경우, <span class="math inline">\(\displaystyle \widehat{odds} = e^{-7.82 + 2.24 \cdot log_2(d)}\)</span> 이므로 odds ratio = <span class="math inline">\(e^{2.24} = 9.4\)</span></p>
<ul>
<li>해석하면, 나무의 두께가 (log2 scale로) 1 늘어남 (2배 증가)에 따라 태풍에 나무가 쓰러질 odds가 9.4배 증가함</li>
<li>다시 말하면, 나무의 두께가 (log2 scale로) 1 늘어남 (2배 증가)에 따라 태풍에 나무가 쓰러지지 않을 가능성 대비 쓰러질 가능성이 9.4배 증가함.</li>
<li>나무의 두께 (원래 d)로 말하면, 두께가 10% 두꺼워지면, <span class="math inline">\(e^{2.24 \cdot log_2(1.1)}=1.36\)</span> 배, 즉 odds가 36% 증가함.</li>
</ul>
<p><span class="math inline">\(b_0\)</span>: d = 1일 때의 odds: <span class="math inline">\(\displaystyle e^{-7.82 + 2.34 \cdot 0} = e^{-7.82} = 0.004\)</span>, 즉 두께가 1cm 일 때 태풍에 나무가 쓰러지지 않을 가능성 대비 쓰러질 가능성은 0.004임.</p>
</section>
<section id="모형의-예측력" class="level2">
<h2 class="anchored" data-anchor-id="모형의-예측력">모형의 예측력</h2>
<ul>
<li>확률 예측에 대한 정확성 (evaluating predicted probability)</li>
<li>Binary outcome에 대한 예측 정확성 (evaluating predicted class)</li>
</ul>
<section id="evaluattion-of-predicted-probability" class="level3">
<h3 class="anchored" data-anchor-id="evaluattion-of-predicted-probability">Evaluattion of predicted probability</h3>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>이제 이 모형이 좋은 모형인지 살펴보기 위해 residual, 잔차를 살펴볼 수 있는가?</p>
<p>Binomial version</p>
<ul>
<li>Pearson residual: <span class="math inline">\(\displaystyle \frac{actual ~ count ~ - predicted ~ count}{SD ~ of ~ count} = \frac{y_i - m_i \hat{p}_i}{\sqrt{m_i \hat{p}_i (1-\hat{p}_i)}}\)</span></li>
<li>Deviance residual: <span class="math inline">\(\displaystyle sign(y_i - m_i\hat{p}_i) \sqrt{2[y_i log(\frac{y_i}{m_i\hat{p}_i}) + (m_i-y_i) log(\frac{m_i - y_i}{m_i-m_i\hat{p}_i})]}\)</span></li>
</ul>
<p>Binary version</p>
<ul>
<li>Pearson residual: <span class="math inline">\(\displaystyle \frac{y_i - \hat{p}_i}{\sqrt{\hat{p}_i (1-\hat{p}_i)}}\)</span></li>
<li>Deviance residual: <span class="math inline">\(\displaystyle sign(y_i - \hat{p}_i) \sqrt{-2[-y_i log(\hat{p}_i) - (1-y_i) log(1-\hat{p}_i)]}\)</span></li>
</ul>
<p>Deviance를 이용해 OLS에서의 <span class="math inline">\(R^2\)</span>와 비슷한 개념을 구성</p>
<ul>
<li>Cox-Snell <span class="math inline">\(R^2\)</span></li>
<li>Nagelkerke <span class="math inline">\(R^2\)</span></li>
</ul>
<p>“Coefficient of discrimination” (Tjur, 2009): average <span class="math inline">\(\hat{p}\)</span> when <span class="math inline">\(y=1\)</span> - average <span class="math inline">\(\hat{p}\)</span> when <span class="math inline">\(y=0\)</span></p>
</div>
</div>
<p><strong>Binomial response</strong>에 대해 residual들을 살펴보면,<br>
<code>glm('died + I(m-died) ~ log2d', data=blowbs_bn, family=sm.families.Binomial())</code></p>
<div class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>blowbs_bn_resid <span class="op">=</span> blowbs_bn.assign(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    prob_pred <span class="op">=</span> mod_bn.fittedvalues,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    died_pred <span class="op">=</span> <span class="kw">lambda</span> x: x.prob_pred <span class="op">*</span> x.m,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    count_resid <span class="op">=</span> <span class="kw">lambda</span> x: x.died <span class="op">-</span> x.died_pred,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    pearson_resid <span class="op">=</span> mod_bn.resid_pearson,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    deviance_resid <span class="op">=</span> mod_bn.resid_deviance,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>blowbs_bn_resid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="119">
<pre><code>       d  died   m    p  log2d  odds  log_odds  prob_pred  died_pred   
0   5.00     7  90 0.08   2.32  0.08     -2.47       0.07       6.15  \
1   6.00     7  92 0.08   2.58  0.08     -2.50       0.12      10.74   
2   7.00    18  91 0.20   2.81  0.25     -1.40       0.18      16.26   
3   8.00    13  70 0.19   3.00  0.23     -1.48       0.25      17.56   
..   ...   ...  ..  ...    ...   ...       ...        ...        ...   
21 27.00     1   1 1.00   4.75 50.00      3.91       0.94       0.94   
22 28.00     2   2 1.00   4.81 50.00      3.91       0.95       1.90   
23 29.00     1   2 0.50   4.86  1.00      0.00       0.96       1.91   
24 32.00     1   1 1.00   5.00 50.00      3.91       0.97       0.97   

    count_resid  pearson_resid  deviance_resid  
0          0.85           0.36            0.35  
1         -3.74          -1.21           -1.29  
2          1.74           0.48            0.47  
3         -4.56          -1.26           -1.30  
..          ...            ...             ...  
21         0.06           0.24            0.34  
22         0.10           0.32            0.45  
23        -0.91          -3.13           -1.88  
24         0.03           0.18            0.26  

[25 rows x 12 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    so.Plot(blowbs_bn_resid, x<span class="op">=</span><span class="st">'log2d'</span>, y<span class="op">=</span><span class="st">'pearson_resid'</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    .add(so.Dot())</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    .add(so.Dot(color<span class="op">=</span><span class="st">"orangered"</span>, alpha<span class="op">=</span><span class="fl">.5</span>), y <span class="op">=</span> <span class="st">'deviance_resid'</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    .label(y<span class="op">=</span><span class="st">"Pearson / Deviance Residuals"</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="120">
<p><img src="logistic_files/figure-html/cell-27-output-1.png" width="599" height="445"></p>
</div>
</div>
<div class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    so.Plot(blowbs_bn_resid, x<span class="op">=</span><span class="st">'prob_pred'</span>, y<span class="op">=</span><span class="st">'p'</span>,)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    .add(so.Dot())</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    .add(so.Line(color<span class="op">=</span><span class="st">".6"</span>), y <span class="op">=</span> <span class="st">'prob_pred'</span>) <span class="co"># y = x line</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    .label(x<span class="op">=</span><span class="st">"Predicted Probability"</span>, y<span class="op">=</span><span class="st">"Emperical Probability"</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="121">
<p><img src="logistic_files/figure-html/cell-28-output-1.png" width="598" height="445"></p>
</div>
</div>
<p><strong>Binary response</strong>에 대해 residual들을 살펴보면,<br>
<code>glm('y ~ log2d', data=blowbs, family=sm.families.Binomial())</code></p>
<div class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>blowbs_resid <span class="op">=</span> blowbs.assign(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    prob_pred <span class="op">=</span> mod.fittedvalues,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    prob_resid <span class="op">=</span> mod.resid_response,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    pearson_resid <span class="op">=</span> mod.resid_pearson,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    deviance_resid <span class="op">=</span> mod.resid_deviance</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>blowbs_resid.sort_values(<span class="st">"d"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="122">
<pre><code>         d    s  y           spp  log2d  prob_pred  prob_resid  pearson_resid   
2102  5.00 0.45  0  black spruce   2.32       0.07       -0.07          -0.27  \
724   5.00 0.18  0  black spruce   2.32       0.07       -0.07          -0.27   
723   5.00 0.18  1  black spruce   2.32       0.07        0.93           3.69   
1687  5.00 0.37  0  black spruce   2.32       0.07       -0.07          -0.27   
...    ...  ... ..           ...    ...        ...         ...            ...   
2634 28.00 0.57  1  black spruce   4.81       0.95        0.05           0.23   
1784 29.00 0.38  1  black spruce   4.86       0.96        0.04           0.22   
1079 29.00 0.25  0  black spruce   4.86       0.96       -0.96          -4.64   
3455 32.00 0.80  1  black spruce   5.00       0.97        0.03           0.18   

      deviance_resid  
2102           -0.38  
724            -0.38  
723             2.32  
1687           -0.38  
...              ...  
2634            0.32  
1784            0.30  
1079           -2.50  
3455            0.26  

[659 rows x 9 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    so.Plot(blowbs_resid, x<span class="op">=</span><span class="st">'log2d'</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    .pair(y<span class="op">=</span>[<span class="st">"prob_resid"</span>, <span class="st">"pearson_resid"</span>, <span class="st">"deviance_resid"</span>])</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    .add(so.Dots(alpha<span class="op">=</span><span class="fl">.3</span>), so.Jitter(y<span class="op">=</span><span class="fl">.5</span>))</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    .add(so.Line(), so.PolyFit(<span class="dv">5</span>))</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    .layout(size<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">8</span>))</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="123">
<p><img src="logistic_files/figure-html/cell-30-output-1.png" width="465" height="753"></p>
</div>
</div>
<p>Emperical probability vs.&nbsp;predicted probability</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
code
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>blowbs_resid[<span class="st">"y2"</span>] <span class="op">=</span> blowbs_resid.y.<span class="bu">map</span>({<span class="dv">0</span>: <span class="st">"survived(y=0)"</span>, <span class="dv">1</span>: <span class="st">"died(y=1)"</span>})</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    so.Plot(blowbs_resid, x<span class="op">=</span><span class="st">'prob_pred'</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    .add(so.Bars(), so.Hist())</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    .facet(<span class="st">"y2"</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    .label(x<span class="op">=</span><span class="st">"Predicted Probability"</span>, y<span class="op">=</span><span class="st">"Count"</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="cell" data-execution_count="124">
<div class="cell-output cell-output-display" data-execution_count="124">
<p><img src="logistic_files/figure-html/cell-31-output-1.png" width="656" height="369"></p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
code
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>blowbs_resid[<span class="st">"prob_cat"</span>] <span class="op">=</span> (</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    pd.cut(</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>        blowbs_resid.prob_pred,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>        bins<span class="op">=</span>np.arange(<span class="dv">0</span>, <span class="dv">11</span>) <span class="op">*</span> <span class="fl">0.1</span>,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>        include_lowest<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">=</span><span class="va">False</span>,  <span class="co"># labels=False: 0, 1, 2, ... 9,</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span> <span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.05</span>  <span class="co"># 각 percentile의 중앙값을 만듦</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>blowbs_resid[[<span class="st">"prob_pred"</span>, <span class="st">"prob_cat"</span>]]</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">#       prob_pred  prob_cat</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 17         0.33      0.35</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 24         0.48      0.45</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 25         0.33      0.35</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 50         0.33      0.35</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ...         ...       ...</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 3636       0.07      0.05</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 3646       0.33      0.35</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 3647       0.79      0.75</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 3661       0.25      0.25</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 각 percentile에서 실제 event(y=1)의 관찰 비율을 계산</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>prob_plot <span class="op">=</span> blowbs_resid.groupby(<span class="st">"prob_cat"</span>)[<span class="st">"y"</span>].mean().reset_index()</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>    so.Plot(prob_plot, x<span class="op">=</span><span class="st">'prob_cat'</span>, y<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    .add(so.Dot())</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>    .add(so.Line(color<span class="op">=</span><span class="st">".6"</span>), y <span class="op">=</span> <span class="st">'prob_cat'</span>) <span class="co"># y = x line</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    .label(x<span class="op">=</span><span class="st">"Predicted Probability"</span>, y<span class="op">=</span><span class="st">"Observed Probability"</span>)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Calibration plot</p>
<div class="cell" data-execution_count="32">
<div class="cell-output cell-output-display" data-execution_count="32">
<p><img src="logistic_files/figure-html/cell-32-output-1.png" width="465" height="369"></p>
</div>
</div>
</section>
<section id="evaluation-of-predicted-class" class="level3">
<h3 class="anchored" data-anchor-id="evaluation-of-predicted-class">Evaluation of predicted class</h3>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>예측된 확률을 기반으로 binary outcome으로 예측하여, 모형의 예측력을 평가</p>
<ul>
<li>예측된 확률값에 대해 임계치를 정하여, 예를 들어 0.5보다 크면 1, 0.5보다 작으면 0으로 분류하여, 이 binary 예측값과 실제값을 비교하여, 예측력을 평가</li>
<li>Confusion matrix</li>
<li>ROC curve</li>
<li>ROC area (AUC) = Concordance ratio</li>
</ul>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="cell-output cell-output-display">
<p><img src="logistic_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 30.0%;justify-content: center;">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Predicted</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Actual</strong></td>
<td style="text-align: center;">survied</td>
<td style="text-align: center;">died</td>
</tr>
<tr class="even">
<td style="text-align: center;">survied</td>
<td style="text-align: center;">377</td>
<td style="text-align: center;">49</td>
</tr>
<tr class="odd">
<td style="text-align: center;">died</td>
<td style="text-align: center;">107</td>
<td style="text-align: center;">126</td>
</tr>
</tbody>
</table>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Predicted</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Actual</strong></td>
<td style="text-align: center;">survied</td>
<td style="text-align: center;">died</td>
</tr>
<tr class="even">
<td style="text-align: center;">survied</td>
<td style="text-align: center;">True Negative</td>
<td style="text-align: center;">False Positive</td>
</tr>
<tr class="odd">
<td style="text-align: center;">died</td>
<td style="text-align: center;">False Negative</td>
<td style="text-align: center;">True Positive</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>mod_lg <span class="op">=</span> logit(<span class="st">'y ~ log2d'</span>, data<span class="op">=</span>blowbs).fit() <span class="co"># logit has .pred_table() method</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.499165
         Iterations 6</code></pre>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># accuracy rate with threshold 0.3</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> mod_lg.pred_table(<span class="fl">0.3</span>) <span class="co"># confusion matrix</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>display(cm)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>(cm[<span class="dv">0</span>, <span class="dv">0</span>] <span class="op">+</span> cm[<span class="dv">1</span>, <span class="dv">1</span>]) <span class="op">/</span> cm.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[298., 128.],
       [ 45., 188.]])</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>0.7374810318664643</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># accuracy rate with threshold 1: no information</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> mod_lg.pred_table(<span class="dv">1</span>) <span class="co"># confusion matrix</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>display(cm)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>(cm[<span class="dv">0</span>, <span class="dv">0</span>] <span class="op">+</span> cm[<span class="dv">1</span>, <span class="dv">1</span>]) <span class="op">/</span> cm.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[426.,   0.],
       [233.,   0.]])</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>0.6464339908952959</code></pre>
</div>
</div>
<p>옳은 예측의 비율</p>
<ul>
<li>True positive rate (TPR) | sensitivity: <span class="math inline">\(\displaystyle P(\hat{y}=1 ~| ~y = 1)\)</span></li>
<li>True negative rate (TNR) | specificity: <span class="math inline">\(\displaystyle P(\hat{y}=0 ~| ~y = 0)\)</span></li>
</ul>
<p>틀린 예측의 비율</p>
<ul>
<li>거짓 양성, False positive rate (FPR): <span class="math inline">\(\displaystyle P(\hat{y}=1 ~| ~y = 0)\)</span> = 1 - TNR</li>
<li>거짓 음성, False negative rate (FNR): <span class="math inline">\(\displaystyle P(\hat{y}=0 ~| ~y = 1)\)</span> = 1 - TPR</li>
</ul>
<p>Receiver operating characteristic (ROC) curve</p>
<p>예측된 확률에 대한 임계치를 조정함에 따라 옳은 예측과 틀린 예측의 비율이 어떻게 달라지는지 살펴봄으로써 임계치를 설정하는데 도움을 줌</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
code
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> roc_curve(blowbs_resid.y, blowbs_resid.prob_pred)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>roc <span class="op">=</span> pd.DataFrame(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"thresholds"</span>: thresholds.<span class="bu">round</span>(<span class="dv">2</span>),</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"False Pos"</span>: fpr,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"sensitivity(True Pos)"</span>: tpr,</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"specificity(True Neg)"</span>: <span class="dv">1</span> <span class="op">-</span> fpr,</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>roc.sort_values(<span class="st">"thresholds"</span>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="cell" data-execution_count="90">
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>    thresholds  False Pos  sensitivity(True Pos)  specificity(True Neg)
25        0.07       1.00                   1.00                   0.00
24        0.12       0.81                   0.97                   0.19
23        0.18       0.61                   0.94                   0.39
22        0.25       0.43                   0.86                   0.57
..         ...        ...                    ...                    ...
19        0.48       0.15                   0.64                   0.85
18        0.55       0.12                   0.54                   0.88
17        0.62       0.09                   0.48                   0.91
16        0.67       0.08                   0.38                   0.92

[10 rows x 4 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="91">
<div class="cell-output cell-output-display" data-execution_count="91">
<p><img src="logistic_files/figure-html/cell-42-output-1.png" width="659" height="465"></p>
</div>
</div>
<div class="cell" data-execution_count="43">
<div class="cell-output cell-output-display" data-execution_count="43">
<p><img src="logistic_files/figure-html/cell-43-output-1.png" width="659" height="465"></p>
</div>
</div>
<p>AUC: Area Under the Curve = concordance index</p>
<ul>
<li>AUC: 각 specificity값에 대한 sensitivity의 합 &gt;&gt; 모형 예측력에 대한 전반적 평가</li>
<li>Concordance index(c): 모든 Y의 쌍, 예를 들어 <span class="math inline">\((0_i, 1_j)\)</span>에 대해서 해당하는 예측된 확률의 크기가 <span class="math inline">\(p_i &lt; p_j\)</span> 인 비율, 즉 순서가 맞는(concordance) 비율</li>
<li>잘못된 예측에 대한 비용이 다르다면, 특정 임계치를 선택</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_auc_score, auc</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>roc_auc <span class="op">=</span> roc_auc_score(blowbs_resid.y, blowbs_resid.prob_pred)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>roc_auc  <span class="co"># auc(fpr, tpr)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>0.8161306897177054</code></pre>
</div>
</div>
<p>Classifier로서 전반적인 모형의 성능 vs.&nbsp;특정 임계치에서의 모형의 성능 vs.&nbsp;확률모형</p>
<ul>
<li>잘못된 예측에 대한 비용이 다르다면, 임계치를 조정하여, 잘못된 예측에 대한 비용을 줄일 수 있음</li>
<li>만약, 농작물에 대한 피해라고 가정하면,
<ul>
<li>Costs: 농작물 피해, 펜스 설치비</li>
<li>Benefits: 수확물의 가치</li>
<li>거짓 음성을 낮춰야 하는 경우: 예를 들어, 농작물의 작은 피해도 심각한 결과를 초래하는 경우</li>
<li>거짓 양성을 낮춰야 하는 경우: 예를 들어, 농작물의 피해 예방을 위한 비용이 큰 경우</li>
</ul></li>
<li>만약, 와인 셀러가 와인의 품질(high:양성 vs.&nbsp;low:음성)을 예측하는 모형을 만든다면, (in <em>Stefanie Molin</em>’s book)
<ul>
<li>Costs: 높은 품질의 와인을 낮은 품질로 예측하면, 와인 품평가에게 신뢰를 잃을 수 있음</li>
<li>Benefits: 낮은 품질의 와인을 높은 품질로 예측하면, 낮은 품질의 와인을 높은 가격에 팔아 수익으로 이어질 수 있음</li>
<li>거짓 음성을 낮춰야 하는 경우: 예를 들어, 영세한 와이너리가 수익이 중요한 경우</li>
<li>거짓 양성을 낮춰야 하는 경우: 예를 들어, 고품질의 와인을 생산하는 것으로 유명한 와이너리; 네임밸류를 유지하기 위해. 반면, 비싼 와인이 싸게 팔리는 것은 감당할 수 있음.</li>
</ul></li>
<li>확률을 정확히 예측하는 모형의 추구;
<ul>
<li>확률값으로 communicate</li>
<li>Decision maker는 당사자</li>
</ul></li>
</ul>
</section>
</section>
<section id="logistic-regression-정리" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression-정리">Logistic Regression 정리</h2>
<p><strong>Binary response</strong>에 대해 그들의 conditional 평균인 확률 <span class="math inline">\(p(x_i)\)</span>를 추정</p>
<p><strong>Distribution</strong>: <span class="math inline">\((Y_i | X = x_i) \sim Bin(m_i, p(x_i))\)</span> 의 분포가 binomial distribution을 따름. 따라서 <span class="math inline">\(Y_i\)</span>의 평균과 분산은 <span class="math inline">\(m_i\)</span>와 <span class="math inline">\(p(x_i)\)</span>에 따라 결정되어 변함.</p>
<ul>
<li>나무의 두께(d)를 가진 m개의 나무들에 대해 태풍에 쓰러지는 나무의 수(count)는 이항분포 <span class="math inline">\(Bin(m, p)\)</span> 를 따름.</li>
</ul>
<p><strong>Linear predictors</strong>: 확률 <span class="math inline">\(p(x_i)\)</span>는 link function (위에서는 logit)를 통해 예측변수들의 선형 결합으로 결정됨.</p>
<ul>
<li><p><span class="math inline">\(\displaystyle log\left(\frac{\hat{p}}{1-\hat{p}}\right) = b_0 + b_1 \cdot X_1 + b_2 \cdot X_2\)</span></p></li>
<li><p>Probit link function으로 쓸 수도 있음: <span class="math inline">\(\displaystyle \Phi^{-1}(\hat{p}) = b_0 + b_1 \cdot X_1 + b_2 \cdot X_2\)</span></p>
<ul>
<li><span class="math inline">\(\Phi\)</span>: cumulative standard normal distribution function</li>
</ul></li>
</ul>
<div class="cell">
<div class="cell-output cell-output-display" data-execution_count="368">
<p><img src="logistic_files/figure-html/cell-56-output-1.png" width="465" height="369"></p>
</div>
</div>
<p>위의 아이디어는 generalized linear model (GLM)로 확장되는데,</p>
<ul>
<li><span class="math inline">\((Y_i | X = x_i)\)</span>의 분포가 exponential family distribution을 따름</li>
<li><span class="math inline">\(Y\)</span>는 예측변수들의 선형 결합으로만 결정되며,</li>
<li>Link function을 통해 <span class="math inline">\(Y_i\)</span>의 평균을 예측함. 즉, <span class="math inline">\(g(E(Y | X=x_i)) = \beta_0 + \beta_1 \cdot x_i\)</span></li>
</ul>
<hr>
</section>
</section>
<section id="exercises" class="level1">
<h1>Exercises</h1>
<section id="a.-blowdown" class="level2">
<h2 class="anchored" data-anchor-id="a.-blowdown">A. Blowdown</h2>
<p>Source: p.274, <em>Applied Linear Regression (4e) by Sanford Weisberg</em></p>
<p>위에서 다룬 <code>blowdown</code> 데이터셋에서 black spruce라는 종에 대해서만 살펴봤는데, 이번에는 black spruce와 aspen 두 종의 나무를 모두 포함한 데이터로 비슷한 모형을 세워 분석해보세요.</p>
<ul>
<li>예측변수에 나무의 종을 나타내는 <code>spp</code>를 추가하고,</li>
<li>나무의 두께(<code>d</code>)에 따라 태풍에 쓰러질(<code>y</code>) 확률이 두 종에서 큰 차이를 보이는지 살펴보고,</li>
<li>그렇다면, 이를 interaction term으로 모형에 추가하여 분석해보세요.
<ul>
<li>나무에 따른 확률 예측값을 그려보고 비교해보세요.</li>
<li>나무에 따라, 나무가 10% 두꺼워지면(<code>d</code>) 쓰러질 odds ratio(OR)가 얼마나 증가하는지 파라미터를 통해 구해보고,</li>
<li>모형의 예측력에 대해서도 1) 확률 측면, 2) binary class 측면에서 살펴보세요.</li>
</ul></li>
</ul>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>blow2 <span class="op">=</span> blowdown.query(<span class="st">'spp in ["black spruce", "aspen"]'</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>blow2[<span class="st">"d"</span>] <span class="op">=</span> np.floor(blow2[<span class="st">"d"</span>])</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>blow2[<span class="st">"log2d"</span>] <span class="op">=</span> np.log2(blow2[<span class="st">"d"</span>])</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>blow2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>         d    s  y           spp  log2d
17    9.00 0.02  0  black spruce   3.17
24   11.00 0.03  0  black spruce   3.46
25    9.00 0.03  0  black spruce   3.17
50    9.00 0.03  0  black spruce   3.17
...    ...  ... ..           ...    ...
3640 29.00 0.94  1         aspen   4.86
3646  9.00 0.94  1  black spruce   3.17
3647 17.00 0.94  1  black spruce   4.09
3661  8.00 0.98  1  black spruce   3.00

[1095 rows x 5 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>blow2_bn <span class="op">=</span> blow2.groupby([<span class="st">"log2d"</span>, <span class="st">"spp"</span>])[<span class="st">"y"</span>].agg([(<span class="st">"died"</span>, <span class="st">"sum"</span>), (<span class="st">"m"</span>, <span class="st">"count"</span>), (<span class="st">"p"</span>, <span class="st">"mean"</span>)]).reset_index()</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>blow2_bn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>    log2d           spp  died   m    p
0    2.32         aspen     0   2 0.00
1    2.32  black spruce     7  90 0.08
2    2.58         aspen     1   2 0.50
3    2.58  black spruce     7  92 0.08
..    ...           ...   ...  ..  ...
66   5.61         aspen     1   1 1.00
67   5.67         aspen     0   1 0.00
68   5.75         aspen     1   1 1.00
69   5.81         aspen     0   1 0.00

[70 rows x 5 columns]</code></pre>
</div>
</div>
</section>
<section id="b.-the-u.s.-youth-risk-behavior-surveillance-system" class="level2">
<h2 class="anchored" data-anchor-id="b.-the-u.s.-youth-risk-behavior-surveillance-system">B. The U.S. Youth Risk Behavior Surveillance System</h2>
<p>Source: p.172, <em>Beyond Multiple Linear Regression, by Paul Roback, Julie Legler.</em></p>
<p>다음에서는 체중감량을 하고자하는 학생들의 의도에 영향을 줄 수 있는 3가지 요소들을 탐색합니다.</p>
<ul>
<li>성별에 따라 (<code>sex</code>)</li>
<li>자신의 비만 정도(BMI)에 따라 (<code>bmipct</code>)</li>
<li>TV에 노출되는 시간이 많을수록 (<code>media</code>)</li>
</ul>
<blockquote class="blockquote">
<p>A sample of 500 teens from data collected in 2009 through the U.S. Youth Risk Behavior Surveillance System (YRBSS) [Centers for Disease Control and Prevention, 2009]. The YRBSS is an annual national school-based survey conducted by the Centers for Disease Control and Prevention (CDC) and state, territorial, and local education and health agencies and tribal governments.</p>
</blockquote>
<p>Data: <a href="https://www.dropbox.com/s/5lc4cosywpg2lh6/diet.csv?dl=1">diet.csv</a></p>
<p><code>lose_wt_01</code></p>
<p>Q66. Which of the following are you trying to do about your weight?<br>
A. Lose weight (1)<br>
B. Gain weight (0)<br>
C. Stay the same weight (0)<br>
D. I am not trying to do anything about my weight (0)</p>
<p><code>media</code></p>
<p>Q81. On an average school day, how many hours do you watch TV?<br>
A. I do not watch TV on an average school day (0)<br>
B. Less than 1 hour per day (0.5)<br>
C. 1 hour per day (1)<br>
D. 2 hours per day (2)<br>
E. 3 hours per day (3)<br>
F. 4 hours per day (4)<br>
G. 5 or more hours per day (5)</p>
<p><code>bmipct</code></p>
<p>The percentile for a given BMI for members of the same sex.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>diet <span class="op">=</span> pd.read_csv(<span class="st">"data/diet.csv"</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>diet</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="423">
<pre><code>            lose_wt  lose_wt_01     sex  media  bmipct
0       Lose weight           1    Male   3.00      98
1    No weight loss           0  Female   1.00      41
2    No weight loss           0    Male   3.00       6
3    No weight loss           0    Male   3.00      41
..              ...         ...     ...    ...     ...
441  No weight loss           0  Female   0.50      43
442  No weight loss           0    Male   3.00      40
443     Lose weight           1  Female   1.00      39
444  No weight loss           0    Male   2.00      34

[445 rows x 5 columns]</code></pre>
</div>
</div>
<ul>
<li>아래 플랏들처럼 탐색적 분석을 수행하고,</li>
<li><code>lose_wt_01</code>을 response로 하는 logistic regression 모형을 세워 분석하고,</li>
<li>모형의 파라미터를 해석한 후</li>
<li>모형의 예측력을 파악하기 위해 위에서 다룬 몇 가지 방식으로 평가하세요.</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-display" data-execution_count="438">
<p><img src="logistic_files/figure-html/cell-60-output-1.png" width="760" height="445"></p>
</div>
</div>
<ul>
<li><code>bmipct</code>를 10개의 percentile 구간으로 나누어 (즉, 10%씩 10개 구간) emperical logit값을 구해 그려볼 것</li>
<li><code>pd.qcut</code>을 이용</li>
<li>Log가 0이 안되도록 적당히 조정하거나 값을 제거할 것.</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-display" data-execution_count="460">
<p><img src="logistic_files/figure-html/cell-62-output-1.png" width="713" height="445"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-display" data-execution_count="480">
<p><img src="logistic_files/figure-html/cell-63-output-1.png" width="760" height="445"></p>
</div>
</div>
<ul>
<li>티비 시청시간(<code>media</code>)을 discrete하게 보고 각 시간 구간에서 emperical logit을 구해 살펴볼 것</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-display" data-execution_count="468">
<p><img src="logistic_files/figure-html/cell-65-output-1.png" width="713" height="445"></p>
</div>
</div>
<p>다음 모형에 대해</p>
<p><code>lose_wt_01 ~ sex + bmipct + media</code></p>
<ul>
<li>모형의 파라미터를 해석해보고,</li>
<li>모형의 예측력에 대해서도 1) 확률 측면, 2) binary class 측면에서 살펴보세요.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../contents/modelling2.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Model building II</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../contents/modelling3_ex.html" class="pagination-link">
        <span class="nav-page-text">Exercises</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">This work © 2023 by Sungkyun Cho is licensed under CC BY-NC-SA 4.0</div>   
  </div>
</footer>



</body></html>